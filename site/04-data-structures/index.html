
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../03-protocol-interactions/">
      
      
        <link rel="next" href="../05-communication-patterns/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Data Structures - MCP Security Analysis</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#4-data-structures-fields" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MCP Security Analysis" class="md-header__button md-logo" aria-label="MCP Security Analysis" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MCP Security Analysis
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Data Structures
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/eilonc-dev/mcp-security-analysis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    eilonc-dev/mcp-security-analysis
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MCP Security Analysis" class="md-nav__button md-logo" aria-label="MCP Security Analysis" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MCP Security Analysis
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/eilonc-dev/mcp-security-analysis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    eilonc-dev/mcp-security-analysis
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-core-concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core Concepts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-protocol-interactions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protocol Interactions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Data Structures
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Data Structures
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#4-data-structures-fields" class="md-nav__link">
    <span class="md-ellipsis">
      4. Data Structures &amp; Fields
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Data Structures &amp; Fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      4.1. Capabilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-resources" class="md-nav__link">
    <span class="md-ellipsis">
      4.2. Resources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-tools" class="md-nav__link">
    <span class="md-ellipsis">
      4.3. Tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      4.4. Prompts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45-sampling-client-feature" class="md-nav__link">
    <span class="md-ellipsis">
      4.5. Sampling (Client Feature)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46-roots-client-feature" class="md-nav__link">
    <span class="md-ellipsis">
      4.6. Roots (Client Feature)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#47-utility-features" class="md-nav__link">
    <span class="md-ellipsis">
      4.7. Utility Features
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-communication-patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Communication Patterns
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-trust-boundaries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trust Boundaries
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-security-considerations-per-component/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security Considerations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-stride-modeling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Threat Modeling (STRIDE)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-implementation-insights/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementation Insights
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-summary-hotspots/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Summary
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Data Structures</h1>

<h2 id="4-data-structures-fields">4. Data Structures &amp; Fields</h2>
<p>This section analyzes the core data structures exchanged via MCP.</p>
<h3 id="41-capabilities">4.1. Capabilities</h3>
<ul>
<li><strong>Structure:</strong> Nested objects declared during <code>initialize</code>. Top-level keys indicate features (<code>resources</code>, <code>tools</code>, <code>prompts</code>, <code>sampling</code>, <code>logging</code>, <code>roots</code>, <code>experimental</code>). Inner keys indicate sub-features (e.g., <code>resources: { subscribe: boolean, listChanged: boolean }</code>).</li>
<li><strong>Purpose:</strong> Define the contract for the session.</li>
<li><strong>Security Considerations:</strong><ul>
<li><strong>Misinterpretation:</strong> Ambiguity in capability definitions could lead to differing implementations and unexpected behavior.</li>
<li><strong>Over-declaration:</strong> A client/server might declare support for features it doesn't handle securely.</li>
<li><strong>Granularity:</strong> Capabilities might not be granular enough to express fine-grained permissions (e.g., allowing <code>resources/list</code> but not <code>resources/read</code> for certain resource types). Authorization (<a href="../03-protocol-interactions/#33-authorization-http-transport">Section 3.3</a>) is the primary mechanism here, but capabilities set the stage.</li>
<li><strong>Experimental Features:</strong> The <code>experimental</code> capability is inherently risky; features under it may be unstable, insecure, or change without notice. Use requires explicit opt-in and understanding of risks.</li>
</ul>
</li>
</ul>
<h3 id="42-resources">4.2. Resources</h3>
<ul>
<li><strong>Purpose:</strong> Represent contextual data (files, web content, database info, etc.).</li>
<li><strong>Key Methods:</strong><ul>
<li><code>resources/list</code>: Discover available resources (supports pagination).</li>
<li><code>resources/read</code>: Retrieve the content of a specific resource by URI.</li>
<li><code>resources/templates/list</code>: Discover parameterized resource templates (URI Templates RFC6570).</li>
<li><code>resources/subscribe</code>: (Optional) Client subscribes to updates for a specific resource URI.</li>
<li><code>notifications/resources/list_changed</code>: (Optional) Server notifies client that the list of resources has changed.</li>
<li><code>notifications/resources/updated</code>: (Optional) Server notifies client that a subscribed resource has changed.</li>
</ul>
</li>
<li><strong>Resource Object:</strong><ul>
<li><code>uri</code>: <code>string</code> (Unique identifier, e.g., <code>file:///</code>, <code>https://</code>, <code>git://</code>, custom schemes).</li>
<li><code>name</code>: <code>string</code> (Human-readable).</li>
<li><code>description</code>: <code>string</code> (Optional).</li>
<li><code>mimeType</code>: <code>string</code> (Optional, e.g., <code>text/plain</code>, <code>image/png</code>, <code>application/json</code>).</li>
<li><code>size</code>: <code>number</code> (Optional, bytes).</li>
</ul>
</li>
<li><strong>Resource Content Object (in <code>resources/read</code> result):</strong><ul>
<li><code>uri</code>: <code>string</code>.</li>
<li><code>mimeType</code>: <code>string</code>.</li>
<li><code>text</code>: <code>string</code> (Mutually exclusive with <code>blob</code>).</li>
<li><code>blob</code>: <code>string</code> (Base64 encoded binary data, mutually exclusive with <code>text</code>).</li>
</ul>
</li>
<li><strong>Resource Template Object:</strong><ul>
<li><code>uriTemplate</code>: <code>string</code> (RFC6570 URI Template).</li>
<li><code>name</code>: <code>string</code>.</li>
<li><code>description</code>: <code>string</code>.</li>
<li><code>mimeType</code>: <code>string</code>.</li>
</ul>
</li>
<li><strong>Security Considerations:</strong><ul>
<li><strong>URI Handling &amp; Path Traversal:</strong> Servers MUST rigorously validate and sanitize incoming URIs (<code>resources/read</code>, <code>resources/subscribe</code>) to prevent path traversal attacks (e.g., <code>file:///../../../etc/passwd</code>). Canonicalize paths and enforce base directory restrictions. Custom URI schemes need equally robust validation.</li>
<li><strong>Access Control:</strong> Servers MUST check authorization <em>before</em> listing (<code>resources/list</code>) or reading (<code>resources/read</code>) resources. Sensitive resources should not be listed or readable without proper permissions.</li>
<li><strong>Data Leakage:</strong> Listing resources (<code>resources/list</code>) might inadvertently leak existence or metadata (name, description, mimeType) of sensitive files/data even if content access is restricted. Consider filtering lists based on permissions.</li>
<li><strong>Large Resource DoS:</strong> A request for a very large resource (<code>resources/read</code>) could cause DoS on the server (memory exhaustion) or client. Servers SHOULD implement size limits and potentially streaming responses (though streaming isn't explicit in the base spec). Clients should also have limits.</li>
<li><strong>Subscription Storms:</strong> Malicious clients could subscribe (<code>resources/subscribe</code>) to many resources or resources that change frequently, causing excessive notifications (<code>notifications/resources/updated</code>) and server load. Rate limiting or subscription limits are needed.</li>
<li><strong>Insecure Content Handling (Client):</strong> Clients receiving resource content (<code>text</code> or <code>blob</code>) must handle it safely based on the <code>mimeType</code>. Displaying HTML/JS content unsanitized could lead to XSS. Executing binary content is risky.</li>
<li><strong>URI Template Injection:</strong> If server-side logic constructs <code>uriTemplate</code> values based on user input without sanitization, it could lead to injection vulnerabilities allowing unintended resource access patterns. Templates themselves should be validated. Client-side expansion of templates also needs care.</li>
<li><strong>Base64 Bombs:</strong> Maliciously crafted large base64 <code>blob</code> data could cause DoS when decoded by the client or server. Implement size limits <em>before</em> decoding.</li>
<li><strong>MIME Type Spoofing:</strong> A malicious server could provide a misleading <code>mimeType</code> (e.g., <code>text/plain</code> for malicious HTML) to trick the client into unsafe handling. Clients should be cautious and potentially validate content against the claimed type.</li>
</ul>
</li>
</ul>
<h3 id="43-tools">4.3. Tools</h3>
<ul>
<li><strong>Purpose:</strong> Represent functions callable by the AI model, enabling interaction with external systems.</li>
<li><strong>Key Methods:</strong><ul>
<li><code>tools/list</code>: Discover available tools (supports pagination).</li>
<li><code>tools/call</code>: Invoke a specific tool by name with arguments.</li>
<li><code>notifications/tools/list_changed</code>: (Optional) Server notifies client that the list of tools has changed.</li>
</ul>
</li>
<li><strong>Tool Object:</strong><ul>
<li><code>name</code>: <code>string</code> (Unique identifier).</li>
<li><code>description</code>: <code>string</code> (Human-readable, intended for LLM).</li>
<li><code>inputSchema</code>: <code>object</code> (JSON Schema defining expected arguments).</li>
<li><code>annotations</code>: <code>object</code> (Optional, untrusted metadata about tool behavior).</li>
</ul>
</li>
<li><strong>Tool Call Params:</strong><ul>
<li><code>name</code>: <code>string</code>.</li>
<li><code>arguments</code>: <code>object</code> (Arguments matching the tool's <code>inputSchema</code>).</li>
</ul>
</li>
<li><strong>Tool Call Result:</strong><ul>
<li><code>content</code>: <code>array</code> (List of content items: <code>text</code>, <code>image</code>, <code>audio</code>, <code>resource</code>).</li>
<li><code>isError</code>: <code>boolean</code> (Indicates if the <em>tool execution</em> failed, distinct from protocol errors).</li>
</ul>
</li>
<li><strong>Security Considerations:</strong><ul>
<li><strong>Arbitrary Code Execution Risk:</strong> Tools fundamentally represent potential code execution on the server or interaction with external APIs. This is the highest-risk feature.</li>
<li><strong>Input Validation:</strong> Servers MUST rigorously validate <code>arguments</code> against the <code>inputSchema</code> <em>before</em> executing the tool logic. This prevents injection attacks (SQLi, command injection, etc.) within the tool implementation. Use established JSON Schema validation libraries.</li>
<li><strong>Access Control:</strong> Servers MUST check if the client (and underlying user) is authorized to call the specific tool (<code>tools/call</code>) and potentially with the given arguments.</li>
<li><strong>Output Sanitization:</strong> Tool results (<code>content</code>) returned to the client MUST be sanitized, especially <code>text</code> content. If results include user-generated or external API data, it could contain malicious scripts (XSS) if rendered directly by the client/host UI. Base64 <code>blob</code> data for images/audio also needs size validation. Embedded <code>resource</code> content inherits resource security considerations.</li>
<li><strong>Untrusted Descriptions/Annotations:</strong> Clients/Hosts MUST treat <code>description</code> and <code>annotations</code> as potentially misleading, especially if the server isn't fully trusted. The LLM might be tricked into calling a harmful tool based on a false description. User confirmation is critical.</li>
<li><strong>Data Exfiltration via Arguments:</strong> The LLM (prompted by a malicious user or compromised) could attempt to exfiltrate sensitive data available in its context by placing it into the <code>arguments</code> of a <code>tools/call</code>. Clients/Hosts SHOULD review arguments before sending or implement data loss prevention (DLP).</li>
<li><strong>Tool Chaining Attacks:</strong> Complex interactions involving multiple tool calls could lead to unexpected states or vulnerabilities.</li>
<li><strong>Denial of Service:</strong> Malicious clients could call tools repeatedly (<code>tools/call</code>) or provide arguments causing excessive computation or external API calls. Rate limiting per-user/per-client/per-tool is essential.</li>
<li><strong>Error Reporting:</strong> Tool execution errors (<code>isError: true</code>) should not leak sensitive internal details in the returned <code>content</code>.</li>
</ul>
</li>
</ul>
<h3 id="44-prompts">4.4. Prompts</h3>
<ul>
<li><strong>Purpose:</strong> Provide structured, templated messages/instructions, often user-initiated (e.g., slash commands).</li>
<li><strong>Key Methods:</strong><ul>
<li><code>prompts/list</code>: Discover available prompts (supports pagination).</li>
<li><code>prompts/get</code>: Retrieve a specific prompt's content, optionally providing arguments for customization.</li>
<li><code>notifications/prompts/list_changed</code>: (Optional) Server notifies client that the list of prompts has changed.</li>
</ul>
</li>
<li><strong>Prompt Object:</strong><ul>
<li><code>name</code>: <code>string</code> (Unique identifier).</li>
<li><code>description</code>: <code>string</code> (Optional, human-readable).</li>
<li><code>arguments</code>: <code>array</code> (Optional, list of argument definitions: <code>name</code>, <code>description</code>, <code>required</code>).</li>
</ul>
</li>
<li><strong>Prompt Get Params:</strong><ul>
<li><code>name</code>: <code>string</code>.</li>
<li><code>arguments</code>: <code>object</code> (Optional, values for defined arguments).</li>
</ul>
</li>
<li><strong>Prompt Get Result:</strong><ul>
<li><code>description</code>: <code>string</code>.</li>
<li><code>messages</code>: <code>array</code> (List of <code>PromptMessage</code> objects).</li>
</ul>
</li>
<li><strong>PromptMessage Object:</strong><ul>
<li><code>role</code>: <code>string</code> (<code>user</code> or <code>assistant</code>).</li>
<li><code>content</code>: <code>object</code> (Can be <code>text</code>, <code>image</code>, <code>audio</code>, or <code>resource</code>). Content structure matches tool results/resource contents.</li>
</ul>
</li>
<li><strong>Security Considerations:</strong><ul>
<li><strong>Argument Injection:</strong> If the server generates the <code>messages</code> in the <code>prompts/get</code> response by inserting provided <code>arguments</code> into templates without proper sanitization, it could lead to injection attacks (e.g., injecting control characters, prompt injection payloads within arguments). Servers MUST sanitize arguments before using them in templates.</li>
<li><strong>Access Control:</strong> Servers should ensure the client is authorized to list (<code>prompts/list</code>) or get (<code>prompts/get</code>) specific prompts, especially if prompts could expose sensitive information or workflows.</li>
<li><strong>Data Exposure in Prompts:</strong> Prompt templates themselves or the results of <code>prompts/get</code> (after argument insertion) might contain sensitive information if not designed carefully.</li>
<li><strong>Misleading Prompts:</strong> Similar to tool descriptions, a malicious server could provide prompts (<code>description</code> or <code>messages</code>) designed to trick the user or LLM into unsafe actions.</li>
<li><strong>Resource Handling:</strong> Embedded <code>resource</code> content within prompt messages inherits all security considerations from <a href="./#42-resources">Section 4.2</a>. Servers must ensure arguments don't lead to unauthorized resource embedding. Clients must handle received resources safely.</li>
<li><strong>Complexity/DoS:</strong> Very complex prompts or prompts requiring extensive server-side processing based on arguments could lead to DoS.</li>
</ul>
</li>
</ul>
<h3 id="45-sampling-client-feature">4.5. Sampling (Client Feature)</h3>
<ul>
<li><strong>Purpose:</strong> Allows Servers to request LLM generation (completion) from the Client/Host.</li>
<li><strong>Capability:</strong> Client declares <code>sampling: {}</code>.</li>
<li><strong>Key Method:</strong><ul>
<li><code>sampling/createMessage</code> (Server -&gt; Client Request): Requests the client to generate a message using its LLM.</li>
</ul>
</li>
<li><strong>Request Params (<code>sampling/createMessage</code>):</strong><ul>
<li><code>messages</code>: <code>array</code> (List of <code>PromptMessage</code> objects, similar to <code>prompts/get</code> result, forming the context/prompt).</li>
<li><code>modelPreferences</code>: <code>object</code> (Optional hints for model selection: <code>hints</code> (array of <code>{name: string}</code>), <code>costPriority</code>, <code>speedPriority</code>, <code>intelligencePriority</code> (all 0-1)).</li>
<li><code>systemPrompt</code>: <code>string</code> (Optional).</li>
<li><code>maxTokens</code>: <code>number</code> (Optional).</li>
</ul>
</li>
<li><strong>Result (<code>sampling/createMessage</code>):</strong><ul>
<li><code>role</code>: <code>string</code> (Usually <code>assistant</code>).</li>
<li><code>content</code>: <code>object</code> (The generated content: <code>text</code>, <code>image</code>, <code>audio</code>).</li>
<li><code>model</code>: <code>string</code> (Identifier of the model used by the client).</li>
<li><code>stopReason</code>: <code>string</code> (Reason generation stopped, e.g., <code>endTurn</code>, <code>maxTokens</code>).</li>
</ul>
</li>
<li><strong>Security Considerations:</strong><ul>
<li><strong>User Consent &amp; Control (CRITICAL):</strong> As the spec <em>strongly recommends</em>, Clients MUST implement robust user confirmation before sending the request to the LLM and potentially before returning the response to the Server. Users should be able to view/edit the prompt.</li>
<li><strong>Prompt Injection from Server:</strong> The <code>messages</code> and <code>systemPrompt</code> provided by the Server could contain malicious instructions intended to manipulate the Client's LLM or exfiltrate data from the Client's context if the Client blindly concatenates them with other data before sending to the LLM.</li>
<li><strong>Resource Consumption (Client-Side):</strong> Malicious Servers could send frequent or computationally expensive <code>sampling/createMessage</code> requests, causing high LLM costs or resource usage on the Client side. Clients MUST implement rate limiting and potentially cost controls.</li>
<li><strong>Data Leakage in Prompts:</strong> Sensitive information from the Server's context could be included in the <code>messages</code> sent to the Client. While the Client controls LLM access, this data is still exposed to the Client application and potentially the user.</li>
<li><strong>Data Leakage in Responses:</strong> The LLM's response (<code>content</code>) might contain sensitive information (either hallucinated or derived from sensitive training data) which is then sent back to the Server. Clients might need to filter/review responses.</li>
<li><strong>Model Selection Manipulation:</strong> A malicious Server might use <code>modelPreferences</code> to try and force the Client to use a less secure or less capable model, although the Client has final control.</li>
<li><strong>Content Validation:</strong> Both Client and Server should validate the content (<code>text</code>, <code>image</code>, <code>audio</code>) received to prevent attacks (e.g., Base64 bombs, malicious media files).</li>
</ul>
</li>
</ul>
<h3 id="46-roots-client-feature">4.6. Roots (Client Feature)</h3>
<ul>
<li><strong>Purpose:</strong> Allows Clients to inform Servers about the accessible filesystem root directories (workspaces, projects).</li>
<li><strong>Capability:</strong> Client declares <code>roots: { listChanged: boolean }</code>.</li>
<li><strong>Key Methods:</strong><ul>
<li><code>roots/list</code> (Server -&gt; Client Request): Server asks the Client for the list of roots.</li>
<li><code>notifications/roots/list_changed</code>: (Optional) Client notifies Server that the list of roots has changed.</li>
</ul>
</li>
<li><strong>Root Object:</strong><ul>
<li><code>uri</code>: <code>string</code> (MUST be a <code>file://</code> URI).</li>
<li><code>name</code>: <code>string</code> (Optional, human-readable).</li>
</ul>
</li>
<li><strong>Security Considerations:</strong><ul>
<li><strong>Information Disclosure:</strong> Exposing root URIs (<code>roots/list</code>) reveals filesystem structure information to the Server. Clients MUST ensure only intended roots are exposed, ideally with user consent per root.</li>
<li><strong>Insecure Root Exposure:</strong> Clients MUST NOT expose sensitive directories (e.g., <code>/</code>, <code>C:\</code>, system folders, user profile root) unless explicitly intended and understood by the user.</li>
<li><strong>URI Validation (Client):</strong> Clients MUST validate the URIs they expose to ensure they are well-formed <code>file://</code> URIs and correspond to actual, intended locations. Path traversal issues are less likely here (as the client <em>provides</em> the roots) but validation is still good practice.</li>
<li><strong>Server Misuse of Roots:</strong> Servers receive the root list as information. They MUST respect these boundaries when constructing resource URIs (e.g., for <code>resources/read</code>). A malicious Server might ignore the roots and try to access files outside them (<code>file:///etc/passwd</code>), relying on the Server's <em>own</em> access control for resources (see <a href="./#42-resources">Section 4.2</a>) to prevent this. The <code>roots</code> mechanism itself is primarily informational for the server.</li>
<li><strong>Race Conditions:</strong> If roots change (<code>notifications/roots/list_changed</code>) while a Server is performing operations based on the old list, inconsistencies could occur. Servers need to handle updates gracefully.</li>
</ul>
</li>
</ul>
<h3 id="47-utility-features">4.7. Utility Features</h3>
<p>Summarizes miscellaneous protocol utilities and their security aspects.</p>
<ul>
<li><strong>Pagination (<code>resources/list</code>, <code>tools/list</code>, <code>prompts/list</code>, etc.):</strong><ul>
<li>Mechanism: Opaque <code>cursor</code> in request params, <code>nextCursor</code> in results.</li>
<li>Security: Cursors MUST be treated as opaque by clients. Servers MUST validate received cursors to prevent unauthorized access to data or information disclosure if cursors encode state/permissions insecurely. Servers should ensure cursors expire or are session-bound.</li>
</ul>
</li>
<li><strong>Cancellation (<code>notifications/cancelled</code>):</strong><ul>
<li>Mechanism: Notification sent by request initiator with <code>requestId</code> to cancel.</li>
<li>Security: Primarily a functional concern. Malicious cancellation floods could cause minor DoS. Receivers MUST validate that the <code>requestId</code> corresponds to an active request they received to prevent cross-request interference (though the impact is likely low).</li>
</ul>
</li>
<li><strong>Progress (<code>notifications/progress</code>):</strong><ul>
<li>Mechanism: Request includes <code>_meta: { progressToken: ... }</code>. Receiver sends notifications with token and progress values (<code>progress</code>, <code>total</code>, <code>message</code>).</li>
<li>Security: <code>progressToken</code> uniqueness must be enforced by the <em>sender</em> of the original request. Receivers should validate tokens correspond to active requests. Sensitive information MUST NOT be leaked in the <code>message</code> field of the progress notification. Progress notification floods could cause minor DoS.</li>
</ul>
</li>
<li><strong>Ping (<code>ping</code> request):</strong><ul>
<li>Mechanism: Simple request/response to check liveness.</li>
<li>Security: Minimal risk. Potential for minor DoS via ping floods if not rate-limited (though less likely to be effective than other methods). Primarily used for connection health.</li>
</ul>
</li>
<li><strong>Logging (<code>notifications/message</code>, <code>logging/setLevel</code> request):</strong><ul>
<li>Mechanism: Server sends log notifications (<code>level</code>, <code>logger</code>, <code>data</code>). Client can optionally set minimum <code>level</code>.</li>
<li>Security (CRITICAL): Log data (<code>params.data</code>) MUST NOT contain sensitive information (credentials, PII, internal system details). Servers MUST sanitize logs before sending. Clients should be careful about displaying raw log data that might contain control characters or other harmful content. Log flooding could cause DoS on the client.</li>
</ul>
</li>
<li><strong>Completion (<code>completion/complete</code> request):</strong><ul>
<li>Mechanism: Client requests suggestions for prompt/resource arguments (<code>ref</code>, <code>argument</code> { <code>name</code>, <code>value</code> }). Server responds with suggestions (<code>values</code>, <code>total</code>, <code>hasMore</code>).</li>
<li>Security: Server MUST validate <code>ref</code> and <code>argument.name</code> to ensure client is authorized to get completions for that item/argument. Suggestions (<code>values</code>) returned by the server MUST NOT leak sensitive information (e.g., suggesting private filenames, user data). Server should rate-limit completion requests. Clients should sanitize suggestions before display.</li>
</ul>
</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "header.autohide", "toc.integrate", "navigation.expand"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>